# Запуск и работа проекта

## Как работает

Основная идея в том, что есть два крона. Первый крон в `wb.service`. Он обращается 
по api WB, забирает данные и сохраняет данные в БД.

Второй крон в `excel.service.ts`. Он берёт данные из БД, затем проходит по списку 
таблиц указанных в `SPREADSHEET_IDS`. Для каждой таблицы происходит проверка существования
листа с названием `EXCEL_TARIF_LIST`. Если лист есть, то он очищается, для заполения 
новыми данными, а если его нет, то он создаётся. Далее соответствующий лист заполняется.


## Как настроить

Авторизация осуществляется через google OAuth, поэтому нужен конфиг с настройками вашего
аккаунта. Эти настройки должны лежать в корне проекта в файле `OAuth.json`. Настройки выглядят так

```
{
  "type",
  "project_id",
  "private_key_id",
  "private_key",
  "client_email",
  "client_id",
  "auth_uri",
  "token_uri",
  "auth_provider_x509_cert_url",
  "client_x509_cert_url",
  "universe_domain",
}
```

Также нужно передать `spreadsheetId` ваших таблиц в массив `SPREADSHEET_IDS`. Не забуддьте
убедиться, что у вашего гугл аккаунта настроен доступ на редактирование к этим таблицам


По умолчанию кроны настроены так, чтобы забирать данные раз в 30 секунд, а обновлять
таблицу раз в 40 секунд. При необходимости это можно поменять на нужные значения

# Шаблон для выполнения тестового задания

## Описание
Шаблон подготовлен для того, чтобы попробовать сократить трудоемкость выполнения тестового задания.

В шаблоне настоены контейнеры для `postgres` и приложения на `nodejs`.  
Для взаимодействия с БД используется `knex.js`.  
В контейнере `app` используется `build` для приложения на `ts`, но можно использовать и `js`.

Шаблон не является обязательным!\
Можно использовать как есть или изменять на свой вкус.

Все настройки можно найти в файлах:
- compose.yaml
- dockerfile
- package.json
- tsconfig.json
- src/config/env/env.ts
- src/config/knex/knexfile.ts

## Команды:

Запуск базы данных:
```bash
docker compose up -d --build postgres
```

Для выполнения миграций и сидов не из контейнера:
```bash
npm run knex:dev migrate latest
```

```bash
npm run knex:dev seed run
```
Также можно использовать и остальные команды (`migrate make <name>`,`migrate up`, `migrate down` и т.д.)

Для запуска приложения в режиме разработки:
```bash
npm run dev
```

Запуск проверки самого приложения:
```bash
docker compose up -d --build app
```

Для финальной проверки рекомендую:
```bash
docker compose down --rmi local --volumes
docker compose up --build
```

PS: С наилучшими пожеланиями!
